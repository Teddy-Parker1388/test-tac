---
# ------------------------------------------------------------------------------
# ==> Harness Application <==
# * This section to be completed with coordination between the DevOps & AppDev Teams *
# ------------------------------------------------------------------------------
# The information in this file is **ONLY** used for the initial set up of your
# application in Harness.
#
# Changing any of these values after your application already exists in Harness
# will **NOT HAVE ANY EFFECT**.
# ------------------------------------------------------------------------------

# Which deployment pipeline to use for the application.
# Since this is the reference application for In-Place deployments,
# the really only valid value is 'in-place'.
deployment_type: in-place

# A list of Harness Group IDs
notifications:
  - DevOps

# Artifact Store and where to find your app's artifact.
artifact:
  # Alias to a known Artifact Server
  # artifactory_cengage_maven | nexus_cengage_maven
  # nexus_mindtap_maven       | nexus_mindtap_npm
  # no_artifact_required
  # If set to `no_artifact_required`, the rest of the values are unnecessary
  server: artifactory_cengage_maven
  # Artifact packaging format: ZIP | TAR | JAR | WAR, etc.
  format: ZIP
  # Artifact Filter (name, pattern, groupId)
  # Artifactory:
  #   - Path w/ wildcards: com/cengage/devops/mostly-harmless/**/*.zip
  # Cengage | Nexus Maven:
  #   - GroupId.Name: com.cengage.devops.mostly-harmless
  # Nexus NPM:
  #   - NPM package name: mostly-harmless
  filter: com/cengage/devops/mostly-harmless/**/*.zip
  # Source repo name for snapshots and releases
  sources:
    snapshots: cengage-snapshots
    releases: cengage-releases

verification:
  # Jenkins jobs that will run as part of the deployment process.
  # Settings Include:
  # * name: A descriptive name for the job
  # * job_name: The actual job name as known to Jenkins
  # * parameters: A mapping of parameters that the job accepts.
  # * environments: The job will run when deployed to any of the envs in the list.
  jenkins:
    - name: Functional Tests
      job_name: mostly-harmless/Functional Tests
      parameters:
        url: http://${context.tsunamiInfra.ROUTE_PRIVATE}:8080
        env: ${env.name}
      environments:
        - dev
        - qa
        - stage
        - perf
        - prod
    - name: Load Tests
      job_name: mostly-harmless/Load Tests
      parameters:
        url: http://${context.tsunamiInfra.ROUTE_PRIVATE}:8080
        env: ${env.name}
        duration: 300
      environments:
        - dev
        - qa
        - stage
        - perf
        - prod
  # --------------------------------------------------------------------------
  # Splunk - Deployment verification by Splunk log analysis
  # --------------------------------------------------------------------------
  # The Splunk analysis will run in parallel with the **LAST** Jenkins job
  # listed above.
  # IF you don't have any traffic going to your site during the deployment
  # verification stage then you don't need to activate the Splunk analysis
  # --------------------------------------------------------------------------
  splunk:
    # List each environment for which you want to activate Splunk analysis.
    # In general, this list should match the 'environments' list from the LAST
    # Jenkins job listed above.
    # To disable Splunk analysis set this value to an empty list: '[]'
    # E.g. `deploy_verification: []`
    deploy_verification:
      - dev
      - qa
      - prod
    # Set a Splunk query to use per environment that will indicate error states
    # or anomalous behavior in your application.
    # If you have disable Splunk analysis, you can set this value to an empty list: '[]'
    # E.g. 'queries: []'
    queries:
      dev: index=devops_nonprod_logs source="mostly-harmless-app-requests-dev" \[ERROR\]
      qa: index=devops_nonprod_logs source="mostly-harmless-app-requests-qa" \[ERROR\]
      stage: index=devops_nonprod_logs source="mostly-harmless-app-requests-stage" \[ERROR\]
      perf: index=devops_nonprod_logs source="mostly-harmless-app-requests-perf" \[ERROR\]
      prod: index=devops_prod_logs source="mostly-harmless-app-requests-prod" \[ERROR\]

# Settings needed by the RFC process to help identify the application in SNOW.
change_management:
  # A Change Management team member can provide this value for the application.
  # An 'item' for your app can be requested in the '#onboarding-harness-snow-apps'
  # Slack channel.
  item: CD-DevOps
  # Valid values: Internal Application|External Application
  sub_category: Internal Application
